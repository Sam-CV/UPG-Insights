

<script>// Data fetching function with local storage caching
    async function getData(sql, cacheBust = false) {
        const cacheKey = `cache_${btoa(sql)}`; // Use base64 encoding for unique keys
        const cacheTimestampKey = `${cacheKey}_timestamp`;

        // Check if cache busting is requested
        if (cacheBust) {
            localStorage.removeItem(cacheKey);
            localStorage.removeItem(cacheTimestampKey);
        }

        // Check if the data is already in local storage and not outdated
        const cachedData = localStorage.getItem(cacheKey);
        const cachedTimestamp = localStorage.getItem(cacheTimestampKey);
        const now = Date.now();

        if (cachedData && cachedTimestamp && now - parseInt(cachedTimestamp, 10) < 3600000) {
            console.log('Fetching from cache: ', cacheKey);
            return JSON.parse(cachedData);
        }

        // Fetch data from the API
        const response = await fetch('https://uwuajcjtvpqf6x4a2wauthzgfi0uifir.lambda-url.ap-southeast-2.on.aws/', {
            method: 'POST',
            body: JSON.stringify({ sql })
        });

        const data = await response.json();
        console.log('Fetching data from API:', data);

        // Store the data and timestamp in local storage
        localStorage.setItem(cacheKey, JSON.stringify(data));
        localStorage.setItem(cacheTimestampKey, now.toString());

        return data;
    }

</script>