<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataFlow - Modern SQL Dashboard</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --surface: #ffffff;
            --surface-elevated: #f8fafc;
            --surface-hover: #f1f5f9;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius: 8px;
            --radius-lg: 12px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            height: 100vh;
            overflow: hidden;
            transition: grid-template-columns 0.3s ease;
        }

        .dashboard.sidebar-collapsed {
            grid-template-columns: 80px 1fr;
        }

        .sidebar {
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-md);
            transition: width 0.3s ease;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 80px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            transition: all 0.3s ease;
        }

        .logo .material-symbols-outlined {
            font-size: 32px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav {
            flex: 1;
            padding: 16px;
        }

        .nav-section {
            margin-bottom: 32px;
        }

        .nav-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 12px;
            padding: 0 12px;
            transition: opacity 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 4px;
            text-decoration: none;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            position: relative;
        }

        .nav-item:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }

        .nav-item .material-symbols-outlined {
            font-size: 20px;
            flex-shrink: 0;
        }

        .nav-item .badge {
            background: var(--warning);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
            transition: opacity 0.3s ease;
            flex-shrink: 0;
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
            font-weight: 500;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid var(--border-light);
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--surface-elevated);
            border-radius: var(--radius);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .main {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: var(--surface);
            padding: 20px 32px;
            border-bottom: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .header-left {
            flex: 1;
        }

        .header-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-subtitle {
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--surface-hover);
            border-color: var(--secondary);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn .material-symbols-outlined {
            font-size: 18px;
            pointer-events: none;
        }

        .content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        .card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: 24px;
            overflow: hidden;
            border: 1px solid var(--border-light);
        }

        .card-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-light);
            background: var(--surface-elevated);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title .material-symbols-outlined {
            color: var(--primary);
        }

        .card-body {
            padding: 24px;
        }

        .table-selector {
            position: relative;
        }

        .select {
            width: 100%;
            padding: 12px 40px 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--surface);
            font-size: 14px;
            appearance: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
        }

        .select-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }

        .filters {
            background: var(--surface-elevated);
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 16px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: 1fr 150px 1fr auto;
            gap: 12px;
            align-items: center;
            margin-bottom: 12px;
        }

        .filter-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .input {
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--surface);
            transition: all 0.2s ease;
        }

        .input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
        }

        .table-container {
            overflow-x: auto;
            max-height: 50vh;
            min-height: 400px;
            height: 100%;
            overflow-y: auto;
            border-radius: var(--radius);
            border: 1px solid var(--border-light);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: var(--surface);
        }

        .table th {
            background: var(--surface-elevated);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            user-select: none;
            position: sticky;
            top: 0;
            z-index: 10;
            transition: all 0.2s ease;
        }

        .table th:hover {
            background: var(--surface-hover);
        }

        .table th.sorted {
            background: #eff6ff;
            color: var(--primary);
        }

        .table th .sort-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .table th .material-symbols-outlined {
            font-size: 18px;
            color: var(--text-muted);
            transition: all 0.2s ease;
        }

        .table th.sorted .material-symbols-outlined {
            color: var(--primary);
        }

        .table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-light);
            font-variant-numeric: tabular-nums;
        }

        .table tr:hover {
            background: var(--surface-elevated);
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            background: var(--surface-elevated);
            border-top: 1px solid var(--border-light);
        }

        .pagination-info {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state .material-symbols-outlined {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px 20px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--error);
        }

        .upload-zone {
            margin-bottom: 24px;
        }

        .upload-area {
            display: block;
            padding: 40px 20px;
            border: 2px dashed var(--border);
            border-radius: var(--radius-lg);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--surface-elevated);
        }

        .upload-area:hover,
        .upload-area.drag-active {
            border-color: var(--primary);
            background: #eff6ff;
            transform: translateY(-2px);
        }

        .upload-area.drag-active {
            border-style: solid;
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.15);
        }

        .upload-icon {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 16px;
            display: block;
        }

        .upload-area h3 {
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .upload-area p {
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        .upload-area .btn {
            margin: 0 auto;
            display: inline-flex;
        }

        .upload-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 12px;
            background: var(--surface);
            transition: all 0.2s ease;
        }

        .upload-item.uploading {
            border-color: var(--primary);
            background: #eff6ff;
        }

        .upload-item.completed {
            border-color: var(--success);
            background: #ecfdf5;
        }

        .upload-item.error {
            border-color: var(--error);
            background: #fef2f2;
        }

        .upload-info {
            flex: 1;
            min-width: 0;
        }

        .upload-filename {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .upload-meta {
            font-size: 12px;
            color: var(--text-muted);
        }

        .upload-progress {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 12px;
            min-width: 200px;
            flex-shrink: 0;
        }

        .progress-bar {
            width: 100px;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 12px;
            color: var(--text-muted);
            min-width: 30px;
        }

        .upload-success {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: flex-end;
            width: 100%;
        }

        .upload-success .material-symbols-outlined {
            color: var(--success);
            font-size: 20px;
        }

        .upload-url {
            font-size: 12px;
            color: var(--primary);
            text-decoration: none;
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .upload-url:hover {
            text-decoration: underline;
        }

        .upload-error {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--error);
            font-size: 12px;
            justify-content: flex-end;
            width: 100%;
        }

        .upload-error .material-symbols-outlined {
            font-size: 18px;
        }

        .copy-url-btn {
            padding: 6px 8px !important;
            min-width: auto !important;
        }

        .copy-url-btn .material-symbols-outlined {
            font-size: 16px;
        }

        .remove-file-btn {
            padding: 6px 8px !important;
            min-width: auto !important;
        }

        .remove-file-btn .material-symbols-outlined {
            font-size: 16px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .hidden {
            display: none !important;
        }

        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-2 {
            gap: 8px;
        }

        .gap-3 {
            gap: 12px;
        }

        .text-sm {
            font-size: 14px;
        }

        .font-medium {
            font-weight: 500;
        }

        .text-muted {
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            .content {
                padding: 16px;
            }

            .filter-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .table th,
            .table td {
                padding: 12px 8px;
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="material-symbols-outlined">database</span>
                    <span>DataFlow</span>
                </div>
            </div>

            <nav class="nav">
                <div class="nav-section">
                    <div class="nav-label">Database</div>
                    <a href="#" class="nav-item active" data-tab="tables">
                        <span class="material-symbols-outlined">table_view</span>
                        <span>Table Explorer</span>
                    </a>
                    <a href="#" class="nav-item" data-tab="chatfuel">
                        <span class="material-symbols-outlined">chat</span>
                        <span>Chatfuel Events</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-label">Media</div>
                    <a href="#" class="nav-item" data-tab="upload">
                        <span class="material-symbols-outlined">cloud_upload</span>
                        <span>Upload Media</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-label">Analytics</div>
                    <a href="#" class="nav-item" data-tab="queries">
                        <span class="material-symbols-outlined">search</span>
                        <span>Flow Analysis</span>
                        <span class="badge">Soon</span>
                    </a>
                    <a href="#" class="nav-item" data-tab="reports">
                        <span class="material-symbols-outlined">bar_chart</span>
                        <span>Reports</span>
                        <span class="badge">Soon</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="connection-status">
                    <span class="status-indicator"></span>
                    <div>
                        <div class="font-medium">Connected</div>
                        <div class="text-sm text-muted">SQL Server</div>
                    </div>
                </div>
                <div
                    style="text-align: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-light);">
                    <div class="text-sm text-muted">DataFlow v1.1.2</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <header class="header">
                <div class="header-content">
                    <div class="header-left">
                        <h1 class="header-title">Table Explorer</h1>
                        <p class="header-subtitle">Browse and analyze your database tables</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-primary" id="refreshBtn">
                            <span class="material-symbols-outlined">refresh</span>
                            <span>Refresh</span>
                        </button>
                    </div>
                </div>
            </header>

            <div class="content">
                <!-- Tables Tab Content -->
                <div id="tablesContent" class="tab-content">
                    <!-- Table Selection -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <span class="material-symbols-outlined">table_rows</span>
                                Select Table
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="table-selector">
                                <select class="select" id="tableSelect">
                                    <option value="">Choose a table...</option>
                                </select>
                                <span class="material-symbols-outlined select-icon">expand_more</span>
                            </div>
                            <div id="loadingTables" class="loading hidden">
                                <div class="spinner"></div>
                                Loading tables...
                            </div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="card" id="filtersCard" style="display: none;">
                        <div class="card-header">
                            <div class="flex items-center justify-between">
                                <h3 class="card-title">
                                    <span class="material-symbols-outlined">filter_alt</span>
                                    Advanced Filters
                                </h3>
                                <button class="btn btn-secondary" id="toggleFiltersBtn">
                                    <span class="material-symbols-outlined">visibility</span>
                                    <span>Show Filters</span>
                                </button>
                            </div>
                        </div>
                        <div class="filters hidden" id="filtersContent">
                            <div id="filterRows"></div>
                            <div class="filter-actions">
                                <button class="btn btn-secondary" id="addFilterBtn">
                                    <span class="material-symbols-outlined">add</span>
                                    Add Filter
                                </button>
                                <button class="btn btn-primary" id="applyFiltersBtn">
                                    <span class="material-symbols-outlined">search</span>
                                    Apply Filters
                                </button>
                                <button class="btn btn-secondary" id="clearFiltersBtn">
                                    <span class="material-symbols-outlined">clear</span>
                                    Clear All
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Data Table -->
                    <div class="card" id="dataCard" style="display: none;">
                        <div class="card-header">
                            <div class="flex items-center justify-between">
                                <h3 class="card-title">
                                    <span class="material-symbols-outlined">dataset</span>
                                    <span id="tableTitle">Table Data</span>
                                </h3>
                                <div class="flex items-center gap-3">
                                    <button class="btn btn-secondary" id="exportBtn">
                                        <span class="material-symbols-outlined">download</span>
                                        Export CSV
                                    </button>
                                    <select class="select" id="pageSizeSelect" style="width: auto;">
                                        <option value="25">25 rows</option>
                                        <option value="50">50 rows</option>
                                        <option value="100">100 rows</option>
                                        <option value="250">250 rows</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="table-container" id="tableContainer">
                            <div id="loadingData" class="loading">
                                <div class="spinner"></div>
                                Loading data...
                            </div>
                        </div>

                        <div class="pagination" id="pagination" style="display: none;">
                            <div class="pagination-info" id="paginationInfo">
                                Showing 1-25 of 1,234 results
                            </div>
                            <div class="pagination-controls">
                                <button class="btn btn-secondary" id="prevBtn">
                                    <span class="material-symbols-outlined">chevron_left</span>
                                    Previous
                                </button>
                                <span id="pageInfo" class="text-muted">Page 1 of 50</span>
                                <button class="btn btn-secondary" id="nextBtn">
                                    Next
                                    <span class="material-symbols-outlined">chevron_right</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chatfuel Events Tab Content -->
                <div id="chatfuelContent" class="tab-content" style="display: none;">
                    <!-- Filters -->
                    <div class="card" id="chatfuelFiltersCard">
                        <div class="card-header">
                            <div class="flex items-center justify-between">
                                <h3 class="card-title">
                                    <span class="material-symbols-outlined">filter_alt</span>
                                    Advanced Filters
                                </h3>
                                <button class="btn btn-secondary" id="chatfuelToggleFiltersBtn">
                                    <span class="material-symbols-outlined">visibility</span>
                                    <span>Show Filters</span>
                                </button>
                            </div>
                        </div>
                        <div class="filters hidden" id="chatfuelFiltersContent">
                            <div id="chatfuelFilterRows"></div>
                            <div class="filter-actions">
                                <button class="btn btn-secondary" id="chatfuelAddFilterBtn">
                                    <span class="material-symbols-outlined">add</span>
                                    Add Filter
                                </button>
                                <button class="btn btn-primary" id="chatfuelApplyFiltersBtn">
                                    <span class="material-symbols-outlined">search</span>
                                    Apply Filters
                                </button>
                                <button class="btn btn-secondary" id="chatfuelClearFiltersBtn">
                                    <span class="material-symbols-outlined">clear</span>
                                    Clear All
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Data Table -->
                    <div class="card" id="chatfuelDataCard">
                        <div class="card-header">
                            <div class="flex items-center justify-between">
                                <h3 class="card-title">
                                    <span class="material-symbols-outlined">chat</span>
                                    <span id="chatfuelTableTitle">Chatfuel User Events</span>
                                </h3>
                                <div class="flex items-center gap-3">
                                    <button class="btn btn-secondary" id="chatfuelExportBtn">
                                        <span class="material-symbols-outlined">download</span>
                                        Export CSV
                                    </button>
                                    <select class="select" id="chatfuelPageSizeSelect" style="width: auto;">
                                        <option value="25">25 rows</option>
                                        <option value="50">50 rows</option>
                                        <option value="100">100 rows</option>
                                        <option value="250">250 rows</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="table-container" id="chatfuelTableContainer">
                            <div id="chatfuelLoadingData" class="loading">
                                <div class="spinner"></div>
                                Loading data...
                            </div>
                        </div>

                        <div class="pagination" id="chatfuelPagination" style="display: none;">
                            <div class="pagination-info" id="chatfuelPaginationInfo">
                                Showing 1-25 of 1,234 results
                            </div>
                            <div class="pagination-controls">
                                <button class="btn btn-secondary" id="chatfuelPrevBtn">
                                    <span class="material-symbols-outlined">chevron_left</span>
                                    Previous
                                </button>
                                <span id="chatfuelPageInfo" class="text-muted">Page 1 of 50</span>
                                <button class="btn btn-secondary" id="chatfuelNextBtn">
                                    Next
                                    <span class="material-symbols-outlined">chevron_right</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Media Upload Tab Content -->
                <div id="uploadContent" class="tab-content" style="display: none;">
                    <!-- File Upload -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <span class="material-symbols-outlined">add_photo_alternate</span>
                                Select Media Files
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="upload-zone">
                                <input type="file" id="fileInput" multiple
                                    accept=".jpg,.jpeg,.png,.mp3,.ogg,.wav,.mp4,image/jpeg,image/png,audio/mpeg,audio/ogg,audio/wav,video/mp4"
                                    style="display: none;">
                                <label for="fileInput" class="upload-area">
                                    <span class="material-symbols-outlined upload-icon">cloud_upload</span>
                                    <h3>Choose Files or Drag & Drop</h3>
                                    <p>Supported: JPG, PNG, MP3, OGG, WAV, MP4 (max 25MB each)</p>
                                    <button type="button" class="btn btn-primary"
                                        onclick="document.getElementById('fileInput').click()">
                                        <span class="material-symbols-outlined">folder_open</span>
                                        Browse Files
                                    </button>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Upload Queue -->
                    <div class="card">
                        <div class="card-header">
                            <div class="flex items-center justify-between">
                                <h3 class="card-title">
                                    <span class="material-symbols-outlined">queue</span>
                                    Upload Queue
                                </h3>
                                <button class="btn btn-primary" id="uploadBtn">
                                    <span class="material-symbols-outlined">cloud_upload</span>
                                    Upload All Files
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="uploadQueue">
                                <div class="empty-state">
                                    <span class="material-symbols-outlined">cloud_upload</span>
                                    <h3>No files selected</h3>
                                    <p>Choose files to upload to your media library</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other tabs -->
                <div id="queriesContent" class="tab-content" style="display: none;">
                    <div class="text-center py-12">
                        <span class="material-symbols-outlined"
                            style="font-size: 64px; opacity: 0.5; display: block; margin-bottom: 16px;">search</span>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Flow Analysis Coming Soon</h3>
                        <p class="text-gray-600">See flow patterns with a visual interface</p>
                    </div>
                </div>

                <div id="reportsContent" class="tab-content" style="display: none;">
                    <div class="text-center py-12">
                        <span class="material-symbols-outlined"
                            style="font-size: 64px; opacity: 0.5; display: block; margin-bottom: 16px;">bar_chart</span>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Reports & Analytics Coming Soon</h3>
                        <p class="text-gray-600">Generate insights and visualizations from your data</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        class Dashboard {
            constructor() {
                this.apiUrl = 'https://uwuajcjtvpqf6x4a2wauthzgfi0uifir.lambda-url.ap-southeast-2.on.aws/';
                this.version = 'v1.1.2';
                this.mediaApiUrl = 'https://ilt7x5cj65bdd2ydpb5odqm7ym0aexif.lambda-url.ap-southeast-2.on.aws/';
                this.tables = [];
                this.selectedTable = null;
                this.columns = [];
                this.tableData = [];
                this.currentPage = 0;
                this.pageSize = 25;
                this.totalRows = 0;
                this.sortColumn = null;
                this.sortDirection = null;
                this.filters = [];
                this.showFilters = false;
                this.activeTab = 'chatfuel';
                this.uploads = [];

                // Chatfuel specific properties
                this.chatfuelColumns = [];
                this.chatfuelTableData = [];
                this.chatfuelCurrentPage = 0;
                this.chatfuelPageSize = 25;
                this.chatfuelTotalRows = 0;
                this.chatfuelSortColumn = null;
                this.chatfuelSortDirection = null;
                this.chatfuelFilters = [];
                this.chatfuelShowFilters = false;

                this.init();
            }

            async init() {
                this.bindEvents();
                this.setActiveTab('chatfuel');
                await this.loadTables();
            }

            bindEvents() {
                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const tab = item.dataset.tab;
                        if (tab) {
                            this.setActiveTab(tab);
                        }
                    });
                });

                // Regular table events
                document.getElementById('tableSelect').addEventListener('change', (e) => {
                    this.selectTable(e.target.value);
                });

                document.getElementById('refreshBtn').addEventListener('click', () => {
                    this.refresh();
                });

                document.getElementById('toggleFiltersBtn').addEventListener('click', () => {
                    this.toggleFilters();
                });

                document.getElementById('addFilterBtn').addEventListener('click', () => {
                    this.addFilter();
                });

                document.getElementById('applyFiltersBtn').addEventListener('click', () => {
                    this.applyFilters();
                });

                document.getElementById('clearFiltersBtn').addEventListener('click', () => {
                    this.clearFilters();
                });

                document.getElementById('prevBtn').addEventListener('click', () => {
                    this.changePage(-1);
                });

                document.getElementById('nextBtn').addEventListener('click', () => {
                    this.changePage(1);
                });

                document.getElementById('pageSizeSelect').addEventListener('change', (e) => {
                    this.pageSize = parseInt(e.target.value);
                    this.currentPage = 0;
                    this.loadTableData();
                });

                document.getElementById('exportBtn').addEventListener('click', () => {
                    this.exportToCSV();
                });

                // Chatfuel events
                document.getElementById('chatfuelToggleFiltersBtn').addEventListener('click', () => {
                    this.toggleChatfuelFilters();
                });

                document.getElementById('chatfuelAddFilterBtn').addEventListener('click', () => {
                    this.addChatfuelFilter();
                });

                document.getElementById('chatfuelApplyFiltersBtn').addEventListener('click', () => {
                    this.applyChatfuelFilters();
                });

                document.getElementById('chatfuelClearFiltersBtn').addEventListener('click', () => {
                    this.clearChatfuelFilters();
                });

                document.getElementById('chatfuelPrevBtn').addEventListener('click', () => {
                    this.changeChatfuelPage(-1);
                });

                document.getElementById('chatfuelNextBtn').addEventListener('click', () => {
                    this.changeChatfuelPage(1);
                });

                document.getElementById('chatfuelPageSizeSelect').addEventListener('change', (e) => {
                    this.chatfuelPageSize = parseInt(e.target.value);
                    this.chatfuelCurrentPage = 0;
                    this.loadChatfuelData();
                });

                document.getElementById('chatfuelExportBtn').addEventListener('click', () => {
                    this.exportChatfuelToCSV();
                });

                // File upload events
                const fileInput = document.getElementById('fileInput');
                if (fileInput) {
                    fileInput.addEventListener('change', (e) => {
                        this.handleFileSelection(e);
                    });
                }

                const uploadArea = document.querySelector('.upload-area');
                if (uploadArea) {
                    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                        uploadArea.addEventListener(eventName, (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                        });
                    });

                    ['dragenter', 'dragover'].forEach(eventName => {
                        uploadArea.addEventListener(eventName, () => {
                            uploadArea.classList.add('drag-active');
                        });
                    });

                    ['dragleave', 'drop'].forEach(eventName => {
                        uploadArea.addEventListener(eventName, () => {
                            uploadArea.classList.remove('drag-active');
                        });
                    });

                    uploadArea.addEventListener('drop', (e) => {
                        const files = e.dataTransfer.files;
                        this.handleFileSelection({ target: { files } });
                    });
                }

                // Upload button and other clicks
                document.addEventListener('click', (e) => {
                    if (e.target.id === 'uploadBtn') {
                        this.uploadSelectedFiles();
                    }
                    if (e.target.classList.contains('copy-url-btn')) {
                        this.copyToClipboard(e.target.dataset.url);
                    }
                    if (e.target.classList.contains('remove-file-btn')) {
                        this.removeSelectedFile(parseInt(e.target.dataset.index));
                    }
                });
            }

            setActiveTab(tab) {
                this.activeTab = tab;

                // Update nav active state
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tab}"]`).classList.add('active');

                // Update header
                this.updateHeader();

                // Show/hide content
                this.showTabContent(tab);

                // Auto-load data for chatfuel tab
                if (tab === 'chatfuel') {
                    this.initializeChatfuelTab();
                }
            }

            updateHeader() {
                const titles = {
                    'tables': 'Table Explorer',
                    'chatfuel': 'Chatfuel Events',
                    'upload': 'Media Upload',
                    'queries': 'Query Builder',
                    'reports': 'Reports & Analytics'
                };

                const subtitles = {
                    'tables': 'Browse and analyze your database tables',
                    'chatfuel': 'View and analyze Chatfuel user events',
                    'upload': 'Upload and manage your media files',
                    'queries': 'Build custom SQL queries',
                    'reports': 'Generate insights and reports'
                };

                const titleEl = document.querySelector('.header-title');
                const subtitleEl = document.querySelector('.header-subtitle');

                if (titleEl) titleEl.textContent = titles[this.activeTab] || 'Dashboard';
                if (subtitleEl) subtitleEl.textContent = subtitles[this.activeTab] || '';
            }

            showTabContent(tab) {
                // Hide all content sections
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });

                // Show active tab content
                const activeContent = document.getElementById(`${tab}Content`);
                if (activeContent) {
                    activeContent.style.display = 'block';
                }
            }

            async initializeChatfuelTab() {
                if (this.chatfuelColumns.length === 0) {
                    await this.loadChatfuelColumns();
                }
                // Reset for fresh loading
                this.chatfuelTotalRows = 0;
                this.chatfuelCurrentPage = 0;
                await this.loadChatfuelData();
            }

            async query(sql) {
                try {
                    console.log('Executing SQL:', sql);
                    const response = await fetch(this.apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ sql })
                    });

                    console.log('Response status:', response.status);
                    console.log('Response headers:', Object.fromEntries(response.headers.entries()));

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('API Error Response:', errorText);
                        throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                    }

                    const data = await response.json();
                    console.log('API Response:', data);

                    if (data.rows !== undefined) {
                        return data;
                    } else if (Array.isArray(data)) {
                        return { rows: data, rowCount: data.length };
                    } else if (data.message) {
                        throw new Error(data.message);
                    } else {
                        return data;
                    }
                } catch (error) {
                    console.error('Query error:', error);
                    this.showNotification('Database query failed: ' + error.message, 'error');
                    throw error;
                }
            }

            getDefaultSortColumn(tableName) {
                if (tableName === 'chatfuel_user_events') {
                    return 'event_datetime';
                }
                return 'created_at'; // Default for most tables
            }

            async loadTables() {
                const loadingEl = document.getElementById('loadingTables');
                const selectEl = document.getElementById('tableSelect');

                if (loadingEl) {
                    loadingEl.classList.remove('hidden');
                }

                try {
                    const sql = `
                        SELECT TABLE_NAME as name
                        FROM INFORMATION_SCHEMA.TABLES 
                        WHERE TABLE_TYPE = 'BASE TABLE' 
                        AND TABLE_SCHEMA = 'dbo'
                        ORDER BY TABLE_NAME
                    `;

                    const result = await this.query(sql);
                    const tables = result.rows || result;
                    this.tables = tables;

                    if (selectEl) {
                        selectEl.innerHTML = '<option value="">Choose a table...</option>';
                        tables.forEach(table => {
                            const option = document.createElement('option');
                            option.value = table.name;
                            option.textContent = table.name;
                            selectEl.appendChild(option);
                        });
                    }

                    this.showNotification(`Loaded ${tables.length} tables`, 'success');
                } catch (error) {
                    console.error('Load tables error:', error);
                    this.showNotification('Failed to load tables: ' + error.message, 'error');
                } finally {
                    if (loadingEl) {
                        loadingEl.classList.add('hidden');
                    }
                }
            }

            async selectTable(tableName) {
                if (!tableName) {
                    this.selectedTable = null;
                    const filtersCard = document.getElementById('filtersCard');
                    const dataCard = document.getElementById('dataCard');
                    if (filtersCard) filtersCard.style.display = 'none';
                    if (dataCard) dataCard.style.display = 'none';
                    return;
                }

                this.selectedTable = tableName;
                this.currentPage = 0;
                this.totalRows = 0; // Reset total for reloading
                this.filters = [];
                this.showFilters = false;

                // Reset sorting - will be set after loading columns
                this.sortColumn = null;
                this.sortDirection = null;

                const tableTitle = document.getElementById('tableTitle');
                const filtersCard = document.getElementById('filtersCard');
                const dataCard = document.getElementById('dataCard');

                if (tableTitle) {
                    tableTitle.textContent = `Data: ${tableName}`;
                }
                if (filtersCard) {
                    filtersCard.style.display = 'block';
                }
                if (dataCard) {
                    dataCard.style.display = 'block';
                }

                await this.loadTableColumns();

                // Set default sorting AFTER columns are loaded
                const defaultSortColumn = this.getDefaultSortColumn(tableName);
                const hasDefaultColumn = this.columns.some(col => col.name === defaultSortColumn);
                if (hasDefaultColumn) {
                    this.sortColumn = defaultSortColumn;
                    this.sortDirection = 'DESC';
                }

                await this.loadTableData();
            }

            async loadTableColumns() {
                if (!this.selectedTable) return;

                try {
                    const sql = `
                        SELECT 
                            COLUMN_NAME as name,
                            DATA_TYPE as type,
                            IS_NULLABLE as nullable
                        FROM INFORMATION_SCHEMA.COLUMNS 
                        WHERE TABLE_NAME = '${this.selectedTable}' 
                        AND TABLE_SCHEMA = 'dbo'
                        ORDER BY ORDINAL_POSITION
                    `;

                    const result = await this.query(sql);
                    this.columns = result.rows || result;
                } catch (error) {
                    console.error('Load columns error:', error);
                    this.showNotification('Failed to load table columns: ' + error.message, 'error');
                }
            }

            async loadChatfuelColumns() {
                try {
                    const sql = `
                        SELECT 
                            COLUMN_NAME as name,
                            DATA_TYPE as type,
                            IS_NULLABLE as nullable
                        FROM INFORMATION_SCHEMA.COLUMNS 
                        WHERE TABLE_NAME = 'chatfuel_user_events' 
                        AND TABLE_SCHEMA = 'dbo'
                        ORDER BY ORDINAL_POSITION
                    `;

                    const result = await this.query(sql);
                    this.chatfuelColumns = result.rows || result;
                } catch (error) {
                    console.error('Load chatfuel columns error:', error);
                    this.showNotification('Failed to load chatfuel columns: ' + error.message, 'error');
                }
            }

            async loadTableData() {
                if (!this.selectedTable) return;

                const containerEl = document.getElementById('tableContainer');
                let loadingEl = document.getElementById('loadingData');
                const paginationEl = document.getElementById('pagination');

                if (!loadingEl) {
                    containerEl.innerHTML = `
                        <div id="loadingData" class="loading">
                            <div class="spinner"></div>
                            Loading first ${this.pageSize} rows...
                        </div>
                    `;
                    loadingEl = document.getElementById('loadingData');
                }

                if (loadingEl) {
                    loadingEl.style.display = 'flex';
                    loadingEl.innerHTML = `
                        <div class="spinner"></div>
                        Loading ${this.currentPage === 0 ? 'first' : 'next'} ${this.pageSize} rows...
                    `;
                }
                if (paginationEl) {
                    paginationEl.style.display = 'none';
                }

                try {
                    // Load data first (fast query)
                    let sql = `SELECT TOP ${this.pageSize} * FROM [dbo].[${this.selectedTable}]`;

                    if (this.filters.length > 0) {
                        const conditions = this.filters.map(filter => this.buildFilterCondition(filter)).filter(Boolean);
                        if (conditions.length > 0) {
                            sql += ` WHERE ${conditions.join(' AND ')}`;
                        }
                    }

                    if (this.sortColumn && this.sortDirection) {
                        sql += ` ORDER BY [${this.sortColumn}] ${this.sortDirection}`;
                    } else {
                        // Check if table has default sort column
                        const defaultSortColumn = this.getDefaultSortColumn(this.selectedTable);
                        const hasDefaultColumn = this.columns.some(col => col.name === defaultSortColumn);
                        if (hasDefaultColumn) {
                            sql += ` ORDER BY [${defaultSortColumn}] DESC`;
                            this.sortColumn = defaultSortColumn;
                            this.sortDirection = 'DESC';
                        } else {
                            sql += ` ORDER BY (SELECT NULL)`;
                        }
                    }

                    // Add pagination for non-first pages
                    if (this.currentPage > 0) {
                        const offset = this.currentPage * this.pageSize;
                        sql = sql.replace(`SELECT TOP ${this.pageSize} *`, 'SELECT *');
                        sql += ` OFFSET ${offset} ROWS FETCH NEXT ${this.pageSize} ROWS ONLY`;
                    }

                    console.log('Data SQL:', sql);

                    // Load data immediately
                    const dataResult = await this.query(sql);
                    this.tableData = dataResult.rows || dataResult;

                    console.log('Loaded data:', this.tableData.length, 'rows');

                    this.renderTable();

                    // Load count in background for pagination (only if we haven't loaded it yet)
                    if (this.totalRows === 0 || this.currentPage === 0) {
                        this.loadTableCount();
                    } else {
                        this.updatePagination();
                    }

                } catch (error) {
                    console.error('Load table data error:', error);
                    this.showNotification('Failed to load table data: ' + error.message, 'error');
                    containerEl.innerHTML = `
                        <div class="empty-state">
                            <span class="material-symbols-outlined">error</span>
                            <h3>Error loading data</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                } finally {
                    const finalLoadingEl = document.getElementById('loadingData');
                    if (finalLoadingEl) {
                        finalLoadingEl.style.display = 'none';
                    }
                }
            }

            async loadTableCount() {
                try {
                    let countSql = `SELECT COUNT(*) as total FROM [dbo].[${this.selectedTable}]`;
                    if (this.filters.length > 0) {
                        const conditions = this.filters.map(filter => this.buildFilterCondition(filter)).filter(Boolean);
                        if (conditions.length > 0) {
                            countSql += ` WHERE ${conditions.join(' AND ')}`;
                        }
                    }

                    console.log('Count SQL:', countSql);
                    const countResult = await this.query(countSql);
                    const countRows = countResult.rows || countResult;
                    this.totalRows = countRows[0].total;

                    console.log('Total rows:', this.totalRows);
                    this.updatePagination();
                } catch (error) {
                    console.error('Load count error:', error);
                    // Don't show error for count - just disable pagination
                    this.totalRows = this.tableData.length;
                    this.updatePagination();
                }
            }

            async loadChatfuelData() {
                const containerEl = document.getElementById('chatfuelTableContainer');
                let loadingEl = document.getElementById('chatfuelLoadingData');
                const paginationEl = document.getElementById('chatfuelPagination');

                if (!loadingEl) {
                    containerEl.innerHTML = `
                        <div id="chatfuelLoadingData" class="loading">
                            <div class="spinner"></div>
                            Loading first ${this.chatfuelPageSize} events...
                        </div>
                    `;
                    loadingEl = document.getElementById('chatfuelLoadingData');
                }

                if (loadingEl) {
                    loadingEl.style.display = 'flex';
                    loadingEl.innerHTML = `
                        <div class="spinner"></div>
                        Loading ${this.chatfuelCurrentPage === 0 ? 'first' : 'next'} ${this.chatfuelPageSize} events...
                    `;
                }
                if (paginationEl) {
                    paginationEl.style.display = 'none';
                }

                try {
                    // Load data first (fast query)
                    let sql = `SELECT TOP ${this.chatfuelPageSize} * FROM [dbo].[chatfuel_user_events]`;

                    if (this.chatfuelFilters.length > 0) {
                        const conditions = this.chatfuelFilters.map(filter => this.buildFilterCondition(filter)).filter(Boolean);
                        if (conditions.length > 0) {
                            sql += ` WHERE ${conditions.join(' AND ')}`;
                        }
                    }

                    if (this.chatfuelSortColumn && this.chatfuelSortDirection) {
                        sql += ` ORDER BY [${this.chatfuelSortColumn}] ${this.chatfuelSortDirection}`;
                    } else {
                        // Default sort by event_datetime DESC
                        sql += ` ORDER BY [event_datetime] DESC`;
                        this.chatfuelSortColumn = 'event_datetime';
                        this.chatfuelSortDirection = 'DESC';
                    }

                    // Add pagination for non-first pages
                    if (this.chatfuelCurrentPage > 0) {
                        const offset = this.chatfuelCurrentPage * this.chatfuelPageSize;
                        sql = sql.replace(`SELECT TOP ${this.chatfuelPageSize} *`, 'SELECT *');
                        sql += ` OFFSET ${offset} ROWS FETCH NEXT ${this.chatfuelPageSize} ROWS ONLY`;
                    }

                    console.log('Chatfuel Data SQL:', sql);

                    // Load data immediately
                    const dataResult = await this.query(sql);
                    this.chatfuelTableData = dataResult.rows || dataResult;

                    console.log('Loaded chatfuel data:', this.chatfuelTableData.length, 'events');

                    this.renderChatfuelTable();

                    // Load count in background for pagination (only if we haven't loaded it yet)
                    if (this.chatfuelTotalRows === 0 || this.chatfuelCurrentPage === 0) {
                        this.loadChatfuelCount();
                    } else {
                        this.updateChatfuelPagination();
                    }

                } catch (error) {
                    console.error('Load chatfuel data error:', error);
                    this.showNotification('Failed to load chatfuel data: ' + error.message, 'error');
                    containerEl.innerHTML = `
                        <div class="empty-state">
                            <span class="material-symbols-outlined">error</span>
                            <h3>Error loading data</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                } finally {
                    const finalLoadingEl = document.getElementById('chatfuelLoadingData');
                    if (finalLoadingEl) {
                        finalLoadingEl.style.display = 'none';
                    }
                }
            }

            async loadChatfuelCount() {
                try {
                    let countSql = `SELECT COUNT(*) as total FROM [dbo].[chatfuel_user_events]`;
                    if (this.chatfuelFilters.length > 0) {
                        const conditions = this.chatfuelFilters.map(filter => this.buildFilterCondition(filter)).filter(Boolean);
                        if (conditions.length > 0) {
                            countSql += ` WHERE ${conditions.join(' AND ')}`;
                        }
                    }

                    console.log('Chatfuel Count SQL:', countSql);
                    const countResult = await this.query(countSql);
                    const countRows = countResult.rows || countResult;
                    this.chatfuelTotalRows = countRows[0].total;

                    console.log('Total chatfuel rows:', this.chatfuelTotalRows);
                    this.updateChatfuelPagination();
                } catch (error) {
                    console.error('Load chatfuel count error:', error);
                    // Don't show error for count - just disable pagination
                    this.chatfuelTotalRows = this.chatfuelTableData.length;
                    this.updateChatfuelPagination();
                }
            }

            buildFilterCondition(filter) {
                if (!filter.column || !filter.operator) return null;

                const column = `[${filter.column}]`;

                switch (filter.operator) {
                    case 'equals':
                        return `${column} = '${filter.value.replace(/'/g, "''")}'`;
                    case 'contains':
                        return `CAST(${column} AS NVARCHAR(MAX)) LIKE '%${filter.value.replace(/'/g, "''")}%'`;
                    case 'not_equals':
                        return `${column} != '${filter.value.replace(/'/g, "''")}'`;
                    case 'greater_than':
                        return `${column} > '${filter.value.replace(/'/g, "''")}'`;
                    case 'less_than':
                        return `${column} < '${filter.value.replace(/'/g, "''")}'`;
                    case 'is_null':
                        return `${column} IS NULL`;
                    case 'is_not_null':
                        return `${column} IS NOT NULL`;
                    default:
                        return null;
                }
            }

            renderTable() {
                const containerEl = document.getElementById('tableContainer');

                if (this.tableData.length === 0) {
                    containerEl.innerHTML = `
                        <div class="empty-state">
                            <span class="material-symbols-outlined">inbox</span>
                            <h3>No data found</h3>
                            <p>This table appears to be empty or your filters returned no results.</p>
                        </div>
                    `;
                    return;
                }

                const columns = Object.keys(this.tableData[0]);

                let tableHtml = `
                    <table class="table">
                        <thead>
                            <tr>
                                ${columns.map(column => `
                                    <th class="${this.sortColumn === column ? 'sorted' : ''}" 
                                        onclick="dashboard.sortBy('${column}')">
                                        <div class="sort-header">
                                            <span>${column}</span>
                                            <span class="material-symbols-outlined">
                                                ${this.getSortIcon(column)}
                                            </span>
                                        </div>
                                    </th>
                                `).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${this.tableData.map(row => `
                                <tr>
                                    ${columns.map(column => `
                                        <td>${this.formatCellValue(row[column])}</td>
                                    `).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                containerEl.innerHTML = tableHtml;
            }

            renderChatfuelTable() {
                const containerEl = document.getElementById('chatfuelTableContainer');

                if (this.chatfuelTableData.length === 0) {
                    containerEl.innerHTML = `
                        <div class="empty-state">
                            <span class="material-symbols-outlined">inbox</span>
                            <h3>No data found</h3>
                            <p>No chatfuel events found or your filters returned no results.</p>
                        </div>
                    `;
                    return;
                }

                const columns = Object.keys(this.chatfuelTableData[0]);

                let tableHtml = `
                    <table class="table">
                        <thead>
                            <tr>
                                ${columns.map(column => `
                                    <th class="${this.chatfuelSortColumn === column ? 'sorted' : ''}" 
                                        onclick="dashboard.sortChatfuelBy('${column}')">
                                        <div class="sort-header">
                                            <span>${column}</span>
                                            <span class="material-symbols-outlined">
                                                ${this.getChatfuelSortIcon(column)}
                                            </span>
                                        </div>
                                    </th>
                                `).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${this.chatfuelTableData.map(row => `
                                <tr>
                                    ${columns.map(column => `
                                        <td>${this.formatCellValue(row[column])}</td>
                                    `).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                containerEl.innerHTML = tableHtml;
            }

            getSortIcon(column) {
                if (this.sortColumn !== column) return 'unfold_more';
                return this.sortDirection === 'ASC' ? 'keyboard_arrow_up' : 'keyboard_arrow_down';
            }

            getChatfuelSortIcon(column) {
                if (this.chatfuelSortColumn !== column) return 'unfold_more';
                return this.chatfuelSortDirection === 'ASC' ? 'keyboard_arrow_up' : 'keyboard_arrow_down';
            }

            sortBy(column) {
                if (this.sortColumn === column) {
                    if (this.sortDirection === 'DESC') {
                        this.sortDirection = 'ASC';
                    } else if (this.sortDirection === 'ASC') {
                        this.sortColumn = null;
                        this.sortDirection = null;
                    }
                } else {
                    this.sortColumn = column;
                    this.sortDirection = 'DESC';  // Start with DESC on first click
                }

                this.currentPage = 0;
                this.totalRows = 0; // Reset total for reloading
                this.loadTableData();
            }

            sortChatfuelBy(column) {
                if (this.chatfuelSortColumn === column) {
                    if (this.chatfuelSortDirection === 'DESC') {
                        this.chatfuelSortDirection = 'ASC';
                    } else if (this.chatfuelSortDirection === 'ASC') {
                        this.chatfuelSortColumn = null;
                        this.chatfuelSortDirection = null;
                    }
                } else {
                    this.chatfuelSortColumn = column;
                    this.chatfuelSortDirection = 'DESC';  // Start with DESC on first click
                }

                this.chatfuelCurrentPage = 0;
                this.chatfuelTotalRows = 0; // Reset total for reloading
                this.loadChatfuelData();
            }

            formatCellValue(value) {
                if (value === null || value === undefined) {
                    return '<em class="text-muted">NULL</em>';
                }
                if (value === '') {
                    return '<em class="text-muted">(empty)</em>';
                }
                if (typeof value === 'string' && value.length > 100) {
                    return value.substring(0, 100) + '...';
                }
                if (typeof value === 'number') {
                    return value.toLocaleString();
                }
                if (typeof value === 'string' && value.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)) {
                    try {
                        return new Date(value).toLocaleString();
                    } catch (e) {
                        return value;
                    }
                }
                return String(value);
            }

            updatePagination() {
                const paginationEl = document.getElementById('pagination');
                const infoEl = document.getElementById('paginationInfo');
                const pageInfoEl = document.getElementById('pageInfo');
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');

                if (!paginationEl) return;

                if (this.totalRows === 0) {
                    paginationEl.style.display = 'none';
                    return;
                }

                paginationEl.style.display = 'flex';

                const start = this.currentPage * this.pageSize + 1;
                const end = Math.min((this.currentPage + 1) * this.pageSize, this.totalRows);
                if (infoEl) {
                    infoEl.textContent = `Showing ${start.toLocaleString()}-${end.toLocaleString()} of ${this.totalRows.toLocaleString()} results`;
                }

                const totalPages = Math.ceil(this.totalRows / this.pageSize);
                if (pageInfoEl) {
                    pageInfoEl.textContent = `Page ${this.currentPage + 1} of ${totalPages}`;
                }

                if (prevBtn) {
                    prevBtn.disabled = this.currentPage === 0;
                }
                if (nextBtn) {
                    nextBtn.disabled = (this.currentPage + 1) * this.pageSize >= this.totalRows;
                }
            }

            updateChatfuelPagination() {
                const paginationEl = document.getElementById('chatfuelPagination');
                const infoEl = document.getElementById('chatfuelPaginationInfo');
                const pageInfoEl = document.getElementById('chatfuelPageInfo');
                const prevBtn = document.getElementById('chatfuelPrevBtn');
                const nextBtn = document.getElementById('chatfuelNextBtn');

                if (!paginationEl) return;

                if (this.chatfuelTotalRows === 0) {
                    paginationEl.style.display = 'none';
                    return;
                }

                paginationEl.style.display = 'flex';

                const start = this.chatfuelCurrentPage * this.chatfuelPageSize + 1;
                const end = Math.min((this.chatfuelCurrentPage + 1) * this.chatfuelPageSize, this.chatfuelTotalRows);
                if (infoEl) {
                    infoEl.textContent = `Showing ${start.toLocaleString()}-${end.toLocaleString()} of ${this.chatfuelTotalRows.toLocaleString()} results`;
                }

                const totalPages = Math.ceil(this.chatfuelTotalRows / this.chatfuelPageSize);
                if (pageInfoEl) {
                    pageInfoEl.textContent = `Page ${this.chatfuelCurrentPage + 1} of ${totalPages}`;
                }

                if (prevBtn) {
                    prevBtn.disabled = this.chatfuelCurrentPage === 0;
                }
                if (nextBtn) {
                    nextBtn.disabled = (this.chatfuelCurrentPage + 1) * this.chatfuelPageSize >= this.chatfuelTotalRows;
                }
            }

            changePage(direction) {
                const newPage = this.currentPage + direction;
                const maxPage = Math.ceil(this.totalRows / this.pageSize) - 1;

                if (newPage >= 0 && newPage <= maxPage) {
                    this.currentPage = newPage;
                    this.loadTableData();
                }
            }

            changeChatfuelPage(direction) {
                const newPage = this.chatfuelCurrentPage + direction;
                const maxPage = Math.ceil(this.chatfuelTotalRows / this.chatfuelPageSize) - 1;

                if (newPage >= 0 && newPage <= maxPage) {
                    this.chatfuelCurrentPage = newPage;
                    this.loadChatfuelData();
                }
            }

            // Filter Management for regular tables
            toggleFilters() {
                this.showFilters = !this.showFilters;
                const filtersEl = document.getElementById('filtersContent');
                const btnEl = document.getElementById('toggleFiltersBtn');

                if (!filtersEl || !btnEl) return;

                const iconEl = btnEl.querySelector('.material-symbols-outlined');
                const textEl = btnEl.querySelector('span:last-child');

                if (this.showFilters) {
                    filtersEl.classList.remove('hidden');
                    if (iconEl) iconEl.textContent = 'visibility_off';
                    if (textEl) textEl.textContent = 'Hide Filters';
                    if (this.filters.length === 0) {
                        this.addFilter();
                    }
                } else {
                    filtersEl.classList.add('hidden');
                    if (iconEl) iconEl.textContent = 'visibility';
                    if (textEl) textEl.textContent = 'Show Filters';
                }
            }

            addFilter() {
                const filter = {
                    column: '',
                    operator: 'equals',
                    value: ''
                };
                this.filters.push(filter);
                this.renderFilters();
            }

            removeFilter(index) {
                this.filters.splice(index, 1);
                this.renderFilters();
            }

            renderFilters() {
                const containerEl = document.getElementById('filterRows');

                if (!containerEl) return;

                containerEl.innerHTML = this.filters.map((filter, index) => `
                    <div class="filter-row">
                        <select class="input" onchange="dashboard.updateFilter(${index}, 'column', this.value)">
                            <option value="">Select Column</option>
                            ${this.columns.map(col => `
                                <option value="${col.name}" ${filter.column === col.name ? 'selected' : ''}>
                                    ${col.name}
                                </option>
                            `).join('')}
                        </select>
                        
                        <select class="input" onchange="dashboard.updateFilter(${index}, 'operator', this.value)">
                            <option value="equals" ${filter.operator === 'equals' ? 'selected' : ''}>Equals</option>
                            <option value="contains" ${filter.operator === 'contains' ? 'selected' : ''}>Contains</option>
                            <option value="not_equals" ${filter.operator === 'not_equals' ? 'selected' : ''}>Not Equals</option>
                            <option value="greater_than" ${filter.operator === 'greater_than' ? 'selected' : ''}>Greater Than</option>
                            <option value="less_than" ${filter.operator === 'less_than' ? 'selected' : ''}>Less Than</option>
                            <option value="is_null" ${filter.operator === 'is_null' ? 'selected' : ''}>Is Null</option>
                            <option value="is_not_null" ${filter.operator === 'is_not_null' ? 'selected' : ''}>Is Not Null</option>
                        </select>
                        
                        <input type="text" 
                               class="input" 
                               placeholder="Value" 
                               value="${filter.value}"
                               ${['is_null', 'is_not_null'].includes(filter.operator) ? 'disabled' : ''}
                               onchange="dashboard.updateFilter(${index}, 'value', this.value)">
                        
                        <button class="btn btn-secondary" onclick="dashboard.removeFilter(${index})">
                            <span class="material-symbols-outlined">delete</span>
                        </button>
                    </div>
                `).join('');
            }

            updateFilter(index, field, value) {
                if (this.filters[index]) {
                    this.filters[index][field] = value;
                    if (field === 'operator') {
                        this.renderFilters();
                    }
                }
            }

            applyFilters() {
                this.currentPage = 0;
                this.loadTableData();
            }

            clearFilters() {
                this.filters = [];
                this.renderFilters();
                this.currentPage = 0;
                this.loadTableData();
            }

            // Filter Management for Chatfuel
            toggleChatfuelFilters() {
                this.chatfuelShowFilters = !this.chatfuelShowFilters;
                const filtersEl = document.getElementById('chatfuelFiltersContent');
                const btnEl = document.getElementById('chatfuelToggleFiltersBtn');

                if (!filtersEl || !btnEl) return;

                const iconEl = btnEl.querySelector('.material-symbols-outlined');
                const textEl = btnEl.querySelector('span:last-child');

                if (this.chatfuelShowFilters) {
                    filtersEl.classList.remove('hidden');
                    if (iconEl) iconEl.textContent = 'visibility_off';
                    if (textEl) textEl.textContent = 'Hide Filters';
                    if (this.chatfuelFilters.length === 0) {
                        this.addChatfuelFilter();
                    }
                } else {
                    filtersEl.classList.add('hidden');
                    if (iconEl) iconEl.textContent = 'visibility';
                    if (textEl) textEl.textContent = 'Show Filters';
                }
            }

            addChatfuelFilter() {
                const filter = {
                    column: '',
                    operator: 'equals',
                    value: ''
                };
                this.chatfuelFilters.push(filter);
                this.renderChatfuelFilters();
            }

            removeChatfuelFilter(index) {
                this.chatfuelFilters.splice(index, 1);
                this.renderChatfuelFilters();
            }

            renderChatfuelFilters() {
                const containerEl = document.getElementById('chatfuelFilterRows');

                if (!containerEl) return;

                containerEl.innerHTML = this.chatfuelFilters.map((filter, index) => `
                    <div class="filter-row">
                        <select class="input" onchange="dashboard.updateChatfuelFilter(${index}, 'column', this.value)">
                            <option value="">Select Column</option>
                            ${this.chatfuelColumns.map(col => `
                                <option value="${col.name}" ${filter.column === col.name ? 'selected' : ''}>
                                    ${col.name}
                                </option>
                            `).join('')}
                        </select>
                        
                        <select class="input" onchange="dashboard.updateChatfuelFilter(${index}, 'operator', this.value)">
                            <option value="equals" ${filter.operator === 'equals' ? 'selected' : ''}>Equals</option>
                            <option value="contains" ${filter.operator === 'contains' ? 'selected' : ''}>Contains</option>
                            <option value="not_equals" ${filter.operator === 'not_equals' ? 'selected' : ''}>Not Equals</option>
                            <option value="greater_than" ${filter.operator === 'greater_than' ? 'selected' : ''}>Greater Than</option>
                            <option value="less_than" ${filter.operator === 'less_than' ? 'selected' : ''}>Less Than</option>
                            <option value="is_null" ${filter.operator === 'is_null' ? 'selected' : ''}>Is Null</option>
                            <option value="is_not_null" ${filter.operator === 'is_not_null' ? 'selected' : ''}>Is Not Null</option>
                        </select>
                        
                        <input type="text" 
                               class="input" 
                               placeholder="Value" 
                               value="${filter.value}"
                               ${['is_null', 'is_not_null'].includes(filter.operator) ? 'disabled' : ''}
                               onchange="dashboard.updateChatfuelFilter(${index}, 'value', this.value)">
                        
                        <button class="btn btn-secondary" onclick="dashboard.removeChatfuelFilter(${index})">
                            <span class="material-symbols-outlined">delete</span>
                        </button>
                    </div>
                `).join('');
            }

            updateChatfuelFilter(index, field, value) {
                if (this.chatfuelFilters[index]) {
                    this.chatfuelFilters[index][field] = value;
                    if (field === 'operator') {
                        this.renderChatfuelFilters();
                    }
                }
            }

            applyChatfuelFilters() {
                this.chatfuelCurrentPage = 0;
                this.loadChatfuelData();
            }

            clearChatfuelFilters() {
                this.chatfuelFilters = [];
                this.renderChatfuelFilters();
                this.chatfuelCurrentPage = 0;
                this.loadChatfuelData();
            }

            async exportToCSV() {
                if (!this.selectedTable) {
                    this.showNotification('Please select a table first', 'error');
                    return;
                }

                try {
                    let sql = `SELECT * FROM [dbo].[${this.selectedTable}]`;

                    if (this.filters.length > 0) {
                        const conditions = this.filters.map(filter => this.buildFilterCondition(filter)).filter(Boolean);
                        if (conditions.length > 0) {
                            sql += ` WHERE ${conditions.join(' AND ')}`;
                        }
                    }

                    if (this.sortColumn && this.sortDirection) {
                        sql += ` ORDER BY [${this.sortColumn}] ${this.sortDirection}`;
                    } else {
                        sql += ` ORDER BY (SELECT NULL)`;
                    }

                    sql = sql.replace('SELECT *', 'SELECT TOP 10000 *');

                    console.log('Export SQL:', sql);
                    const result = await this.query(sql);
                    const data = result.rows || result;

                    if (data.length === 0) {
                        this.showNotification('No data to export', 'error');
                        return;
                    }

                    const headers = Object.keys(data[0]);
                    const csvHeaders = headers.map(h => `"${h}"`).join(',');

                    const csvRows = data.map(row => {
                        return headers.map(header => {
                            let value = row[header];
                            if (value === null || value === undefined) return '';
                            if (typeof value === 'string') {
                                return `"${value.replace(/"/g, '""')}"`;
                            }
                            return `"${value}"`;
                        }).join(',');
                    });

                    const csv = [csvHeaders, ...csvRows].join('\n');

                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().split('T')[0];
                    const filename = `${this.selectedTable}_export_${timestamp}.csv`;

                    link.href = URL.createObjectURL(blob);
                    link.download = filename;
                    link.click();

                    URL.revokeObjectURL(link.href);

                    this.showNotification(`Exported ${data.length.toLocaleString()} rows to ${filename}`, 'success');

                } catch (error) {
                    console.error('Export error:', error);
                    this.showNotification('Export failed: ' + error.message, 'error');
                }
            }

            async exportChatfuelToCSV() {
                try {
                    let sql = `SELECT * FROM [dbo].[chatfuel_user_events]`;

                    if (this.chatfuelFilters.length > 0) {
                        const conditions = this.chatfuelFilters.map(filter => this.buildFilterCondition(filter)).filter(Boolean);
                        if (conditions.length > 0) {
                            sql += ` WHERE ${conditions.join(' AND ')}`;
                        }
                    }

                    if (this.chatfuelSortColumn && this.chatfuelSortDirection) {
                        sql += ` ORDER BY [${this.chatfuelSortColumn}] ${this.chatfuelSortDirection}`;
                    } else {
                        sql += ` ORDER BY [event_datetime] DESC`;
                    }

                    sql = sql.replace('SELECT *', 'SELECT TOP 10000 *');

                    console.log('Chatfuel Export SQL:', sql);
                    const result = await this.query(sql);
                    const data = result.rows || result;

                    if (data.length === 0) {
                        this.showNotification('No data to export', 'error');
                        return;
                    }

                    const headers = Object.keys(data[0]);
                    const csvHeaders = headers.map(h => `"${h}"`).join(',');

                    const csvRows = data.map(row => {
                        return headers.map(header => {
                            let value = row[header];
                            if (value === null || value === undefined) return '';
                            if (typeof value === 'string') {
                                return `"${value.replace(/"/g, '""')}"`;
                            }
                            return `"${value}"`;
                        }).join(',');
                    });

                    const csv = [csvHeaders, ...csvRows].join('\n');

                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().split('T')[0];
                    const filename = `chatfuel_user_events_export_${timestamp}.csv`;

                    link.href = URL.createObjectURL(blob);
                    link.download = filename;
                    link.click();

                    URL.revokeObjectURL(link.href);

                    this.showNotification(`Exported ${data.length.toLocaleString()} rows to ${filename}`, 'success');

                } catch (error) {
                    console.error('Chatfuel export error:', error);
                    this.showNotification('Export failed: ' + error.message, 'error');
                }
            }

            refresh() {
                if (this.activeTab === 'chatfuel') {
                    this.loadChatfuelData();
                } else if (this.selectedTable) {
                    this.loadTableData();
                } else {
                    this.loadTables();
                }
            }

            // Media upload methods (keeping existing functionality)
            handleFileSelection(event) {
                const files = Array.from(event.target.files);
                const allowedTypes = ['image/jpeg', 'image/png', 'audio/mpeg', 'audio/ogg', 'audio/wav', 'video/mp4'];
                const maxSize = 25 * 1024 * 1024;

                files.forEach(file => {
                    if (!allowedTypes.includes(file.type)) {
                        this.showNotification(`File type ${file.type} not allowed`, 'error');
                        return;
                    }

                    if (file.size > maxSize) {
                        this.showNotification(`File ${file.name} is too large (max 25MB)`, 'error');
                        return;
                    }

                    this.uploads.push({
                        file: file,
                        status: 'pending',
                        progress: 0,
                        url: null,
                        id: Date.now() + Math.random()
                    });
                });

                this.renderUploadQueue();

                if (event.target.value !== undefined) {
                    event.target.value = '';
                }
            }

            async uploadSelectedFiles() {
                const pendingUploads = this.uploads.filter(upload => upload.status === 'pending');

                if (pendingUploads.length === 0) {
                    this.showNotification('No files to upload', 'error');
                    return;
                }

                for (const upload of pendingUploads) {
                    await this.uploadSingleFile(upload);
                }
            }

            async uploadSingleFile(upload) {
                upload.status = 'uploading';
                upload.progress = 0;
                this.renderUploadQueue();

                try {
                    const base64Data = await this.fileToBase64(upload.file);

                    upload.progress = 25;
                    this.renderUploadQueue();

                    const response = await fetch(this.mediaApiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            fileName: upload.file.name,
                            mimeType: upload.file.type,
                            fileData: base64Data
                        })
                    });

                    upload.progress = 75;
                    this.renderUploadQueue();

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Upload failed: ${response.status}`);
                    }

                    const result = await response.json();

                    if (result.success) {
                        upload.status = 'completed';
                        upload.progress = 100;
                        upload.url = result.data.publicUrl;
                        upload.s3Key = result.data.s3Key;
                        upload.uploadedAt = result.data.uploadedAt;

                        this.showNotification(`Successfully uploaded ${upload.file.name}`, 'success');
                    } else {
                        throw new Error(result.error || 'Upload failed');
                    }

                } catch (error) {
                    console.error('Upload error:', error);
                    upload.status = 'error';
                    upload.error = error.message;
                    this.showNotification(`Failed to upload ${upload.file.name}: ${error.message}`, 'error');
                }

                this.renderUploadQueue();
            }

            fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = error => reject(error);
                });
            }

            renderUploadQueue() {
                const container = document.getElementById('uploadQueue');
                if (!container) return;

                if (this.uploads.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <span class="material-symbols-outlined">cloud_upload</span>
                            <h3>No files selected</h3>
                            <p>Choose files to upload to your media library</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.uploads.map((upload, index) => `
                    <div class="upload-item ${upload.status}">
                        <div class="upload-info">
                            <div class="upload-filename">${upload.file.name}</div>
                            <div class="upload-meta">
                                ${this.formatFileSize(upload.file.size)} • ${upload.file.type}
                            </div>
                        </div>
                        
                        <div class="upload-progress">
                            ${upload.status === 'uploading' ? `
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${upload.progress}%"></div>
                                </div>
                                <div class="progress-text">${upload.progress}%</div>
                            ` : ''}
                            
                            ${upload.status === 'completed' ? `
                                <div class="upload-success">
                                    <span class="material-symbols-outlined">check_circle</span>
                                    <a href="${upload.url}" target="_blank" class="upload-url">${upload.url}</a>
                                    <button class="btn btn-secondary copy-url-btn" data-url="${upload.url}">
                                        <span class="material-symbols-outlined">content_copy</span>
                                    </button>
                                </div>
                            ` : ''}
                            
                            ${upload.status === 'error' ? `
                                <div class="upload-error">
                                    <span class="material-symbols-outlined">error</span>
                                    ${upload.error}
                                </div>
                            ` : ''}
                            
                            ${upload.status === 'pending' ? `
                                <button class="btn btn-secondary remove-file-btn" data-index="${index}">
                                    <span class="material-symbols-outlined">delete</span>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            removeSelectedFile(index) {
                this.uploads.splice(index, 1);
                this.renderUploadQueue();
            }

            async copyToClipboard(text) {
                try {
                    await navigator.clipboard.writeText(text);
                    this.showNotification('URL copied to clipboard!', 'success');
                } catch (error) {
                    console.error('Copy failed:', error);
                    this.showNotification('Failed to copy URL', 'error');
                }
            }

            showNotification(message, type = 'success') {
                const existing = document.querySelectorAll('.notification');
                existing.forEach(n => n.remove());

                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <span class="material-symbols-outlined">
                        ${type === 'success' ? 'check_circle' : 'error'}
                    </span>
                    <span>${message}</span>
                `;

                document.body.appendChild(notification);

                setTimeout(() => notification.classList.add('show'), 100);

                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
        }

        const dashboard = new Dashboard();
    </script>
</body>

</html>